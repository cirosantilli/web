<!doctype html>
<html lang=en>
<head>
    <meta charset=utf-8>
    <title>Canvas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
</head>
<body>
    <p>This looks like a good example: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Basic_animations">https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Basic_animations</a></p>
    <div>enable: <input type="checkbox" id="enable" checked></input></div>
    <div>save images: <input type="checkbox" id="save-images-checkbox"></input></div>
    <div>fps granule: <input type="text" id="fps-granule" value="5"></input></div>
    <div>total frames: <span id="total_frames"></span></div>
    <div>fps: <span id="fps"></span></div>
    <canvas id="my-canvas" width="512" height="512" style="border:1px solid black;"></canvas>
    <script>
var canvas = document.getElementById("my-canvas");
var ctx = canvas.getContext("2d");
var pixel_size = 1;
var t = 0;
var fps_span = document.getElementById("fps");
var fps_last_date = new Date();
var fps_granule_input = document.getElementById("fps-granule");
var save_images_checkbox = document.getElementById("save-images-checkbox");
var enable_checkbox = document.getElementById("enable");
enable_checkbox.addEventListener('change', drawIfEnabled)
var total_frames_span = document.getElementById("total_frames");
total_frames_span.innerHTML = t.toString();

function drawIfEnabled() {
    if (enable_checkbox.checked) {
        window.requestAnimationFrame(draw);
    }
}

/* We need this to fix t because toBlob calls are asynchronous. */
function createBlobFunc(t) {
  return function(blob) {
    saveAs(blob, t.toString() + '.png');
  };
}

function draw() {
    console.log("draw");
    for (x = 0; x < canvas.width; x += pixel_size) {
        for (y = 0; y < canvas.height; y += pixel_size) {
            var b = ((1.0 + Math.sin(t * Math.PI / 16)) / 2.0);
            ctx.fillStyle =
                "rgba(" +
                (x / canvas.width) * 255 + "," +
                (y / canvas.height) * 255 + "," +
                b * 255 +
                ",255)"
            ;
            ctx.fillRect(x, y, pixel_size, pixel_size);
        }
    }
    // Save the images to files.
    // https://stackoverflow.com/questions/19235286/convert-html5-canvas-sequence-to-a-video-file/57153718#57153718
    if (save_images_checkbox.checked) {
        canvas.toBlob(createBlobFunc(t));
    }
    t++;
    total_frames_span.innerHTML = t.toString();
    var fps_granule = parseInt(fps_granule_input.value);
    if (t % fps_granule == 0) {
        var fps_date = new Date();
        fps_span.innerHTML = (1000.0 * fps_granule / (fps_date - fps_last_date)).toFixed(2);
        fps_last_date = fps_date;
    }
    if (enable_checkbox.checked) {
        window.requestAnimationFrame(draw);
    }
    drawIfEnabled()
}
drawIfEnabled()
    </script>
</body>
</html>
